<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../stylesheets/style.css">
    <link rel="stylesheet" type="text/css" href="../stylesheets/tabs.css">
    <link rel="stylesheet" type="text/css" href="../stylesheets/map.css">

    <!--Firebase Libraries and Init with config-->
    <script src="https://www.gstatic.com/firebasejs/4.7.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.7.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.7.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.9.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.9.1/firebase-firestore.js"></script>

    <script type="text/javascript" src="../javascripts/FirebaseInitialisation.js"></script>
    <script type="text/javascript" src="../javascripts/Firebase.js"></script>
    <script type="text/javascript" src="../javascripts/Client.js"></script>
    <script type="text/javascript" src="../javascripts/Mine.js"></script>
    <script type="text/javascript" src="../javascripts/Block.js"></script>
    <script type="text/javascript" src="../javascripts/Message.js"></script>



    <script>
        var users = [];
    </script>

    <title>Blockchain</title>

</head>
<body>

<!--Logo Elements-->
<div class="logo-container" >
    <img id="logo-tall" src="https://i.imgur.com/sb4fvdm.png"/>
    <img id="logo-wide" src="https://i.imgur.com/vxaU676.png"/>
</div>
<!--Client map-->
<ul id="map"></ul>


<div class="message tabbox">
    <!--Tab Headers-->
    <input class="tabs" id="tab1" type="radio" name="tabs" checked>
    <label class="tab" for="tab1">Messages</label>

    <input class="tabs" id="tab2" type="radio" name="tabs">
    <label class="tab" for="tab2">Blocks</label>

    <input class="tabs" id="tab3" type="radio" name="tabs">
    <label class="tab" for="tab3">Clients</label>

    <input class="tabs" id="tab4" type="radio" name="tabs">
    <label class="tab" for="tab4">Mining</label>

    <!--Message Tab-->
    <section id="content1">
        <div class = "tab_contents">
            <div class="tab_header">
                <div class="header_box">
                    <input class="m_input" id="sampleText" type="text" name="fname" placeholder="Write Message Here.." value="">
                    <button class="m_send" id="btn_Update" onclick="updateMessage()">Send</button>
                </div>
            </div>
            <div id="m1" class="item_portion">
                <div class = "m_leftsection">
                    <div class = "m_leftsectionupper">
                        <div class = "m_user">John</div>
                        <div class = "m_timesection">
                            <div class = "m_timetitle">Time: </div>
                            <div class = "m_time">12:58</div>
                        </div>
                    </div>
                    <div class="m_progresssection">
                        <div class="m_progressbar">
                            <div class="m_progress"></div>
                        </div>
                    </div>
                </div>
                <div class = "m_content">
                    Hello There!!
                </div>
                <div class = "m_cblock"></div>
            </div>
            <div id="m2" class="item_portion">
                <div class = "m_leftsection">
                    <div class = "m_leftsectionupper">
                        <div class = "m_user">John</div>
                        <div class = "m_timesection">
                            <div class = "m_timetitle">Time: </div>
                            <div class = "m_time">12:58</div>
                        </div>
                    </div>
                    <div class="m_progresssection">
                        <div class="m_progressbar">
                            <div class="m_progress"></div>
                        </div>
                    </div>
                </div>
                <div class = "m_content">
                    Hello There!!
                </div>
                <div class = "m_cblock"></div>
            </div>
            <div id="m3" class="item_portion">
                <div class = "m_leftsection">
                    <div class = "m_leftsectionupper">
                        <div class = "m_user">John</div>
                        <div class = "m_timesection">
                            <div class = "m_timetitle">Time: </div>
                            <div class = "m_time">12:58</div>
                        </div>
                    </div>
                    <div class="m_progresssection">
                        <div class="m_progressbar">
                            <div class="m_progress"></div>
                        </div>
                    </div>
                </div>
                <div class = "m_content">
                    Hello There!!
                </div>
                <div class = "m_cblock"></div>
            </div>
            <div id="m4" class="item_portion">
                <div class = "m_leftsection">
                    <div class = "m_leftsectionupper">
                        <div class = "m_user">John</div>
                        <div class = "m_timesection">
                            <div class = "m_timetitle">Time: </div>
                            <div class = "m_time">12:58</div>
                        </div>
                    </div>
                    <div class="m_progresssection">
                        <div class="m_progressbar">
                            <div class="m_progress"></div>
                        </div>
                    </div>
                </div>
                <div class = "m_content">
                    Hello There!!
                </div>
                <div class = "m_cblock"></div>
            </div>

        </div>
    </section>

    <!--Blocks Tab-->
    <section id="content2">
        <div class = "tab_contents">
            <div class="tab_header">
                <div class="header_box">
                    <div class="single_chunk" id="b_difficulty">Difficulty: 45</div>
                    <div class="single_chunk" id="b_chainlength">Chain Length: 45</div>

                </div>
            </div>
            <div id="b1" class="item_portion">
                <div class="b_leftsection">
                    <div class="single_chunk b_number">122</div>
                    <div class="single_chunk b_ts">12:59</div>
                    <div class="single_chunk b_ph">af45ad</div>
                </div>
                <div class="b_midsection">
                    <div class="single_chunk b_nonce">4562</div>
                    <div class="single_chunk b_fb">John</div>
                    <div class="single_chunk b_col">#00B7FF</div>
                </div>
                <div class="b_rightsection">
                    <div class="b_messagesbox">
                        <div class="b_message">
                            <div class="b_messageuser">John</div>
                            <div class="b_messagecontent">Hello There!!</div>
                            <div class="b_messagetime">12:58</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!--Clients Header-->
    <section id="content3">
        <div class = "tab_contents">
            <div class="tab_header">
                <div class="header_box">
                    <button class="c_add" id="c_btn_add" onclick="Bot()">+</button>
                </div>
            </div>

            <ul id="tabs_client_list" class="tab_items_list">

                <!--<li id="c2" class="item_portion">-->
                    <!--<div class="c_leftsection">-->
                        <!--<div class="c_block"></div>-->
                    <!--</div>-->
                    <!--<div class="c_midsection">First Entry - Needs Removing</div>-->
                    <!--<div class="c_rightsection">-->
                        <!--<label class="switch">-->
                            <!--<input type="checkbox" checked>-->
                            <!--<span class="slider round"></span>-->
                        <!--</label>-->
                        <!--<button class="c_remove" id="c_btn_remove" onclick="removeBot()">-</button>-->
                    <!--</div>-->
                <!--</li>-->

            </ul>
        </div>
    </section>

    <!--Mining Header-->
    <section id="content4">
        <div class = "tab_contents">
            <div class="tab_header">
                <div class="header_box">
                    <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider round"></span>
                    </label>

                </div>
            </div>

            <div class="miner_statlayer1">
                <div class="miner_statlayer_leftsection">Current Block</div>
                <div class="miner_statlayer_midsection">Difficulty</div>
            </div>
            <div class="miner_statlayer2">
                <div class="miner_statlayer_leftsection">Nonce</div>
                <div class="miner_statlayer_midsection">Package</div>

            </div>
            <div class="miner_statlayer2">
                <div class="miner_statlayer_leftsection">Hit</div>
                <div class="miner_statlayer_midsection">Difficulty</div>

            </div>

            <div id="a1" class="item_portion miner_attempt">
                <div class="a_col_block">a</div>
                <div class="a_col_hit">a</div>
                <div class="a_col_nonce">a</div>
                <div class="a_col_package">a</div>
                <div class="a_col_message">a</div>
            </div>
            <div id="a2" class="item_portion miner_attempt">
                <div class="a_col_block">a</div>
                <div class="a_col_hit">a</div>
                <div class="a_col_nonce">a</div>
                <div class="a_col_package">a</div>
                <div class="a_col_message">a</div>
            </div>
            <div id="a3" class="item_portion miner_attempt">
                <div class="a_col_block">a</div>
                <div class="a_col_hit">a</div>
                <div class="a_col_nonce">a</div>
                <div class="a_col_package">a</div>
                <div class="a_col_message">a</div>
            </div>
        </div>
    </section>

</div>

<p id="load">Firebase SDK Loading&hellip;</p>

<div id="messageSnackbar" class="messageSnackbar">Text updated across all devices viewing this page</div>

<script>

    var db = firebase.firestore();

    db.collection("users").get().then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
            let user = new User();
            let dbUser = doc.data();
            user.userID = doc.id;
            user.name = dbUser.name;
            user.coX = dbUser.coX;
            user.coY = dbUser.coY;
            user.blockColour = dbUser.blockColour;
            user.bot = dbUser.bot;
            user.mining = dbUser.mining;

            addUser(user);
            Node(user);
        });
    });

    //update the message
    function updateMessage() {
        var text = document.getElementById('sampleText').value;
        dbRef.set(text);
        document.getElementById('sampleText').value = "";
        snackbar("Message Updated");
    }

    function snackbar(text){
        var snackbar = document.getElementById("messageSnackbar");
        snackbar.innerText = text;
        snackbar.className = "show";
        setTimeout(function(){ snackbar.className = snackbar.className.replace("show", ""); }, 3000);
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // // The Firebase SDK is initialized and available here!
        //
        // firebase.auth().onAuthStateChanged(user => { });
        // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
        // firebase.messaging().requestPermission().then(() => { });
        // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
        //
        // // 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

        try {
            let app = firebase.app();
            let features = ['auth', 'database', 'messaging', 'storage', 'firestore'].filter(feature => typeof app[feature] === 'function');
            document.getElementById('load').innerHTML = `Firebase SDK loaded with ${features.join(', ')}`;
        } catch (e) {
            console.error(e);
            document.getElementById('load').innerHTML = '!!  FIREBASE BROKEN  !!';
        }
    });
</script>

</body>
</html>