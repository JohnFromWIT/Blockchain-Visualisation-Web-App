<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../stylesheets/style.css">
    <link rel="stylesheet" type="text/css" href="../stylesheets/tabs.css">
    <link rel="stylesheet" type="text/css" href="../stylesheets/Tooltips.css">
    <link rel="stylesheet" type="text/css" href="../stylesheets/map.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!--Firebase Libraries and Init with config-->
    <script src="https://www.gstatic.com/firebasejs/4.7.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.7.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.7.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.9.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.9.1/firebase-firestore.js"></script>

    <script type="text/javascript" src="../javascripts/FirebaseInitialisation.js"></script>
    <script type="text/javascript" src="../javascripts/Firebase.js"></script>
    <script type="text/javascript" src="../javascripts/Profanity.js"></script>

    <script type="text/javascript" src="../javascripts/Utility.js"></script>

    <script type="text/javascript" src="../javascripts/Mine.js"></script>
    <script type="text/javascript" src="../javascripts/Block.js"></script>
    <script type="text/javascript" src="../javascripts/Message.js"></script>
    <script type="text/javascript" src="../javascripts/Propogate.js"></script>

    <!--Views-->
    <script type="text/javascript" src="../javascripts/Views/Block.js"></script>
    <script type="text/javascript" src="../javascripts/Views/Client.js"></script>
    <script type="text/javascript" src="../javascripts/Views/Message.js"></script>
    <script type="text/javascript" src="../javascripts/Views/Mine.js"></script>

    <!--Models-->
    <script type="text/javascript" src="../javascripts/Models/Block.js"></script>
    <script type="text/javascript" src="../javascripts/Models/Client.js"></script>
    <script type="text/javascript" src="../javascripts/Models/Message.js"></script>

    <!--Controllers-->
    <script type="text/javascript" src="../javascripts/Controllers/Block.js"></script>
    <script type="text/javascript" src="../javascripts/Controllers/Client.js"></script>
    <script type="text/javascript" src="../javascripts/Controllers/Message.js"></script>



    <script>

        var localUser = new User();
        localUser.userID = "U2FmC6Sj5R6KxwUXHRPb";

        window.onload = function() {
            initApp();
        };

        function initApp() {
            // Listening for auth state changes. Is user signed in?
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    // snackbar("Welcome " + firebase.auth.currentUser.displayName);
                    // localUser.userID = firebase.auth().currentUser.uid;
                    // localUser.name = firebase.auth().currentUser.displayName;
                } else {
                    window.location.replace('../index.html')
                }
            });
        }


        var users = [];
        var allBlocks = [];
        var chain = [];
        var networkDiff = 2318932150;
        var messages = [];
        // a = Hash(0xf6c94957, 0x27359d02, 3).toString(16);
        var chainLength = 0;


        // localUser.userID = "fadfasfddasdasf";
        // localUser.name = "Johnny";
    </script>

    <title>Blockchain</title>

</head>
<body>
<!--NavBar-->
<div class="navigation-bar">
    <div id="navigation-container">
        <img id="logo" src="../images/long/logo.png">
        <!--<ul>-->
            <!--<li><a href="#">Home</a></li>-->
        <!--</ul>-->
    </div>
</div>

<!--Client map-->
<ul id="map"></ul>


<div class="message tabbox">
    <!--Tab Headers-->
    <input class="tabs" id="tab1" type="radio" name="tabs" checked>
    <label class="tab" title="Messages Tab" for="tab1"><div class="fa fa-comment"></div><div class="tab-text">Messages</div></label>

    <input class="tabs" id="tab2" type="radio" name="tabs">
    <label class="tab" title="Blocks Tab" for="tab2"><div class="fa fa-cube"></div><div class="tab-text">Blocks</div></label>

    <input class="tabs" id="tab3" type="radio" name="tabs">
    <label class="tab" title="Clients Tab" for="tab3"><div class="fa fa-user"></div><div class="tab-text">Clients</div></label>

    <input class="tabs" id="tab4" type="radio" name="tabs">
    <label class="tab" title="Mining Tab" for="tab4"><div class="fa fa-diamond"></div><div class="tab-text">Mining</div></label>

    <span class="tooltip fa fa-info-circle"><span class="tooltip-content clearfix"><img src="https://heydesign.com/wp-content/uploads/2017/08/Cool-Logos-and-Graphic-Trends-about-Music-DJs-750x500.jpg" /><span class="tooltip-text">Explain what's here</span></span></span>
    <!--Message Tab-->
    <section id="content1">
        <div class = "tab_contents">
            <div class="tab_header">
                <div class="header_box">
                    <input class="m_input" id="messageText" type="text" name="fname" placeholder="Write Message Here.." value="">
                    <button class="m_send" title="Adds a new message." id="btn_NewMessage" onclick="newMessage()"><div class="fa fa-send send-icon"></div><div class ="send-text">Send</div></button>
                </div>
            </div>

            <ul id="tabs_message_list" class="tab_items_list">
            </ul>

        </div>
    </section>

    <!--Blocks Tab-->
    <section id="content2">
        <div class = "tab_contents">


            <div class="tab_header">
                <div class="header_box">
                    <div class="title" title="Current Network Difficulty" id="b_difficulty">Difficulty: 45</div>
                    <div class="single_chunk"  title="Current Chain Length" id="b_chainlength">Chain Length: 45</div>
                </div>
            </div>

<ul id="tabs_block_list" class = "tab_items_list">

</ul>

        </div>
    </section>

    <!--Clients Header-->
    <section id="content3">
        <div class = "tab_contents">
            <div class="tab_header">
                <div class="header_box">
                    <button class="c_add" id="c_btn_add" title="Add a Bot" onclick="newBot()">+</button>
                </div>
            </div>

            <ul id="tabs_client_list" class="tab_items_list">

            </ul>
        </div>
    </section>

    <!--Mining Header-->
    <section id="content4">
        <div class = "tab_contents">
            <div class="tab_header">
                <div class="header_box">
                    <label class="switch">
                        <input id="userMine" type="checkbox" checked>
                        <span  title="Switch Mining On Off" class="slider round"></span>
                    </label>

                </div>
            </div>

            <div class="miner_statlayer1">
                <div class="miner_statlayer_leftsection title">Current Block</div>
            </div>
            <div class="miner_statlayer2">
                <div class="miner_statlayer_leftsection">

                    <div class="miner_statlayer1_leftsection_title">
                        <div class="mi_block" title="Current block colour" style="background: rgb(202, 135, 197)"></div>
                        Block#: </div>
                    <div id="m_s" class="miner_statlayer1_leftsection_content">1</div>
                </div>
            </div>

                <div class="miner_statlayer2">
                <div class="miner_statlayer_leftsection">
                    <div class="miner_statlayer_leftsection_title title">Nonce</div>
                    <div id="m_nonce" class="miner_statlayer_leftsection_content">45</div>
                </div>
                <div class="miner_statlayer_midsection">
                    <div class="miner_statlayer_midsection_title title">Package</div>
                    <div id="m_package" class="miner_statlayer_midsection_content">45</div>

                </div>

            </div>
            <div class="miner_statlayer2">
                <div class="miner_statlayer_leftsection">
                    <div class="miner_statlayer_leftsection_title title">Hit</div>
                    <div id="m_hit" class="miner_statlayer_leftsection_content">Yes</div>

                </div>
                <div class="miner_statlayer_midsection">
                    <div class="miner_statlayer_midsection_title title">Difficulty</div>
                    <div id="m_difficulty" class="miner_statlayer_midsection_content">45</div>

                </div>
            </div>

            <div id="attempts_titles" class="miner_attempt">
                <div class="a_col_block title">Block</div>
                <div class="a_col_hit title">Hit</div>
                <div class="a_col_nonce title">Nonce</div>
                <div class="a_col_package title">Package</div>
                <div class="a_col_messages title">Messages</div>
            </div>

            <ul id = "mine_attempts"></ul>

        </div>
    </section>

</div>

<p  title="Firebase Message" id="load">Firebase SDK Loading&hellip;</p>

<div id="messageSnackbar"  title="Message Snackbar" class="messageSnackbar">Welcome</div>

<script>


    // var db = firebase.firestore();
    retrieveAll();
    setDatabaseListeners();
    window.setInterval(propogate, 2000);

    var msgInput = document.getElementById("messageText");
    msgInput.addEventListener("keyup", function(event) {
        event.preventDefault();
        if (event.keyCode === 13) {
            newMessage();
        }
    });

    var userMine = document.getElementById("userMine");
    userMine.addEventListener("click", function() {
        // alert(findUser("W5w2XC8W3lW23qF3FziB").name);
        mineOnOff(findUser(localUser.userID));
    });

    //New message


</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // // The Firebase SDK is initialized and available here!
        //
        // firebase.auth().onAuthStateChanged(user => { });
        // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
        // firebase.messaging().requestPermission().then(() => { });
        // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
        //
        // // 🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥🔥

        try {
            let app = firebase.app();
            let features = ['auth', 'database', 'messaging', 'storage', 'firestore'].filter(feature => typeof app[feature] === 'function');
            document.getElementById('load').innerHTML = `Firebase SDK loaded with ${features.join(', ')}`;
        } catch (e) {
            console.error(e);
            document.getElementById('load').innerHTML = '!!  FIREBASE BROKEN  !!';
        }
    });
</script>

</body>
</html>